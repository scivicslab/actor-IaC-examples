name: main-collect-and-analyze

description: |
  Collect system info from all nodes and summarize GPU information using plugin.

steps:
  - states: ["0", "1"]
    note: Collect system info on all nodes
    actions:
      - actor: nodeGroup
        method: apply
        arguments:
          actor: "node-*"
          method: runWorkflow
          arguments: ["collect-sysinfo.yaml"]

  - states: ["1", "2"]
    note: Load plugin JAR
    actions:
      - actor: loader
        method: loadJar
        arguments: ["plugins/actor-IaC-plugins-1.0.0.jar"]

  - states: ["2", "3"]
    note: Create aggregator actor
    actions:
      - actor: loader
        method: createChild
        arguments: ["loader", "aggregator", "com.scivicslab.actoriac.plugins.h2analyzer.SystemInfoAggregator"]

  - states: ["3", "4"]
    note: Connect to log database
    actions:
      - actor: aggregator
        method: connect
        arguments: ["./actor-iac-logs"]

  - states: ["4", "end"]
    note: Summarize GPU info
    actions:
      - actor: aggregator
        method: summarize-gpus
